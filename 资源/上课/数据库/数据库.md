[TOC]

# 数据库和数据表的建立、修改和删除

## 1-1 建立数据库

### 任务要求

建立`library`数据库 并显示所有数据库

### 答案

```mysql
 #代码开始
create database library;
show databases;
 #代码结束
```

## 1-2 建立读者数据库

### 任务要求

①切换到图书(`library`)数据库； 

②创建读者数据表(`dz`)数据表(指定表结构如下图所示)； 

③查看数据表的详细结构；

数据表结构如下：

![1](C:\Users\WH\Desktop\数据库\1.png)

### 答案

```mysql
 #代码开始
use library;
 create table dz(
     dzzh int(3) zerofill primary key auto_increment  comment '读者证号',
     xm varchar(8) not null comment '姓名',
     xb enum('男','女') default '男' comment '性别',
     sf  enum('研究生','工作人员','教研人员') default '研究生' comment'身份'
 );
desc dz;
 #代码结束
```

## 1-3 修改数据表名字

### 任务描述

本关任务：修改数据表`dz`的名字为`reader`

### 答案

```mysql
use library;
#代码开始
 alter table dz rename reader;
 #代码结束
 describe reader;
```

## 1-4 在数据表中添加字段

### 任务描述

本关任务：在`reader`读者数据表中增加一个`dhhm`电话号码字段，存储11位电话号码

### 答案

```mysql
 use library;
#代码开始
 alter table reader add dhhm varchar(11);
 #代码结束
 describe reader;
```

## 1-5 修改数据表的字段名称

### 任务描述

本关任务：修改读者字段的`dhhm`的字段名称改为`mobile`

### 答案

```mysql
 use library;
 #代码开始
 alter table reader change dhhm mobile varchar(11);
 #代码结束
 describe reader;
```

## 1-6 修改数据表的字段类型

### 任务描述

本关任务：修改`reader`数据表的电话号码(`dhhm`)字段为可变长字符型的12位

### 答案

```mysql
use library;
#代码开始
alter table reader modify dhhm varchar(12);
#代码结束
describe reader;
```

## 1-7 删除数据库的字段

### 任务描述

本关任务：删除读者数据表的电话号码字段

### 答案

```mysql
 use library;
 #代码开始
 alter table reader drop dhhm;
 #代码结束
 describe reader;
```

## 1-8 删除数据表

### 任务描述

本关任务：删除读者(`reader`)数据表，显示数据库中所有的数据表

### 答案

```mysql
 use library;
 #代码开始
 drop table reader;
 show tables;
 #代码结束
```

## 1-9 删除数据库

### 任务描述

本关任务：

1、删除`library`数据库 

2、显示所有的数据库

### 答案

```mysql
 #代码开始
 drop database library;
 show databases;
 #代码结束
```

# 数据操作

## 2-1 建立读者数据表

### 任务要求

①切换到图书(`library`)数据库； 

②创建读者数据表(`dz`)数据表(指定表结构如下图所示)； 

③查看数据表的详细结构；

数据表结构如下： 

![2](C:\Users\WH\Desktop\数据库\2.png)

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## update the value ##########
update tb_emp set Name = 'Tracy', DeptId = 302, Salary = 4300.00 where Id = 3;
########## End ##########
SELECT * FROM tb_emp;
```

## 2-2 插入数据

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码：

- 我们为你新建了一个空数据表`tb_emp`，请你为它同时添加`3`条数据内容；
- 空数据表结构如下，注意`字段3` 为`DeptId`，倒数第二个字母为大写的`i`：

![3](C:\Users\WH\Desktop\数据库\3.png)

- 需要你同时添加的数据内容为：(注意，是同时插入多条记录)

![4](C:\Users\WH\Desktop\数据库\4.png)

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## bundle insert the value ##########
insert into tb_emp(Id,Name,DeptId,salary) values(1,'Nancy',301,2300.00),(2,'Tod',303,5600.00),(3,'Carly',301,3200.00);
########## End ##########
SELECT * FROM tb_emp;
```

## 2-3 带LIKE的字符匹配查询

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码；

我们为你新建了一个数据表`tb_emp`，结构如下：

![5](C:\Users\WH\Desktop\数据库\5.png)

- 请你查询所有`Name`以字母`C`为起始的员工的`Name`和`Salary`的内容；

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## delete the value ##########
SELECT Name, Salary FROM tb_emp WHERE Name LIKE 'C%';
########## End ##########
```

## 2-4 对查询结果进行排序

### 编程要求

在右侧编辑器`Begin-End`处补充代码，查询学生成绩表中1班同学的所有信息并以**成绩降序**的方式显示结果。

我们已经为你提供了学生成绩表： `tb_score`表数据：

| stu_id | class_id | name  | score |
| ------ | -------- | ----- | ----- |
| 1      | 2        | Jack  | 81    |
| 2      | 1        | David | 74    |
| 3      | 1        | Mason | 92    |
| 4      | 2        | Ethan | 89    |
| 5      | 1        | Gina  | 65    |

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
UPDATE tb_Salary
SET sex = CASE 
    WHEN sex = 'm' THEN 'f'
    WHEN sex = 'f' THEN 'm'
END;
########## End ##########
```

# 单表查询

## 3-1基本查询语句

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码：

我们为你新建了一个数据表`tb_emp`，结构如下：

![6](C:\Users\WH\Desktop\数据库\6.png)

- 请你查询字段`Name`和`Salary`的内容；
- 请你查询整张表的内容

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## retrieving the Name and Salary ##########
select Name,Salary from tb_emp;
########## retrieving all the table ##########
select * from tb_emp;
########## End ##########
```

## 3-2 带IN关键字的查询

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码:

我们为你新建了一个数据表`tb_emp`，结构如下：

![7](C:\Users\WH\Desktop\数据库\7.png)

- 请你查询当`Id`不等于1时，字段`Name`和`Salary`的内容;

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## retrieving the Name and Salary with IN statement ##########
select Name,Salary from tb_emp where Id != 1;
########## End ##########
```

## 3-3 带BETWEEN AND的范围查询

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码：

我们为你新建了一个数据表`tb_emp`，结构如下：

![8](C:\Users\WH\Desktop\数据库\8.png)

- 请你查询当字段`Salary`范围在`3000~5000`时，字段`Name`和`Salary`的内容

### 答案

```mysql
USE Company;
#请在此处添加实现代码
########## Begin ##########
########## retrieving the Name and Salary with BETWEEN AND statement ##########
select Name,Salary from tb_emp where Salary between 3000 and 5000;
########## End ##########
```

## 3-4 带LIKE的字符匹配查询

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码；

我们为你新建了一个数据表`tb_emp`，结构如下：

![9](C:\Users\WH\Desktop\数据库\9.png)

- 请你查询所有`Name`以字母`C`为起始的员工的`Name`和`Salary`的内容；

### 答案

```mysql
USE Company;
######### Begin #########
select Name,Salary from tb_emp where Name like 'C%';
######### End #########
```

## 3-5 带AND与OR的多条件查询

### 编程要求

根据提示，在右侧编辑器`Begin-End`处补充代码：

我们为你新建了一个数据表`tb_emp`，内容如下：

![10](C:\Users\WH\Desktop\数据库\10.png)

结构如下：

![11](C:\Users\WH\Desktop\数据库\11.png)

- 使用关键字`AND`返回数据表中字段`DeptId`为`301`并且薪水大于`3000`的所有字段的内容，其中`DeptId`的倒数第二个字母为`i`的大写；
- 使用关键字`IN`返回数据表中字段`DeptId`为`301`和`303`的所有字段的内容

### 答案

```mysql
USE Company;
######### Begin #########
select * from tb_emp where DeptId = 301 and Salary > 3000;
######### End #########
######### Begin #########
select * from tb_emp where DeptId in (301,303);
######### End #########
```

## 3-6 对查询结果进行排序

### 编程要求

在右侧编辑器`Begin-End`处补充代码，查询学生成绩表中`1`班同学的所有信息并以**成绩降序**的方式显示结果。

我们已经为你提供了学生成绩表： `tb_score`表数据：

| stu_id | class_id | name  | score |
| ------ | -------- | ----- | ----- |
| 1      | 2        | Jack  | 81    |
| 2      | 1        | David | 74    |
| 3      | 1        | Mason | 92    |
| 4      | 2        | Ethan | 89    |
| 5      | 1        | Gina  | 65    |

### 答案

```mysql
USE School;
#请在此处添加实现代码
########## Begin ##########
########## 查询1班同学的所有信息以成绩降序的方式显示结果 ##########
select * from tb_score where class_id = 1 order by score desc;
########## End ##########
```

## 3-7 分组查询

### 编程要求

在右侧编辑器`Begin-End`处补充代码，对班级表中的**班级名称**进行分组查询。

我们已经为你提供了班级表信息： `tb_class`表数据：

| stu_id | class_id | name  |
| ------ | -------- | ----- |
| 1      | 367      | Jack  |
| 2      | 366      | David |
| 3      | 366      | Mason |
| 4      | 367      | Ethan |
| 5      | 366      | Gina  |

### 答案

```mysql
USE School;
#请在此处添加实现代码
########## Begin ##########
########## 对班级名称进行分组查询 ##########
select * from tb_class where class_id in(366,367) group by class_id;
########## End ##########
```

# 多表查询与子查询

## 4-1 查询每个学生的选修的课程信息

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**：查询每个学生的选修的课程信息，显示`sno`、`sn`、`cn`、`ct`，并按`ct`降序排列

### 答案

```mysql
 use teaching;
 #--下面输入代码
 select s.sno, s.sn, c.cn, c.ct from s join sc on s.sno = sc.sno join c on sc.cno = c.cno order by c.ct desc;
 #--代码结束
```

## 4-2 查询选修了“数据结构”课程的学生名单

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**： 查询选修了“数据结构”课程的学生名单，显示`sno`，`sn`，按学号升序排序

### 答案

```mysql
 use teaching;
 #--下面输入代码
 select s.sno, s.sn from s,sc,c where s.sno = sc.sno and sc.cno = c.cno and c.cn = '数据结构' order by s.sno;
 #--代码结束 
```

## 4-3 查询“数据结构”课程的学生成绩单

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**： 查询“数据结构”课程的学生成绩单，显示`sno`，`sn`，`score`，按成绩降序排列

### 答案

```mysql
 use teaching;
 #--下面输入代码
 select s.sno, s.sn,sc.score from s,c,sc where s.sno = sc.sno and c.cno = sc.cno and c.cn = '数据结构' order by sc.score desc;
 #--代码结束
```

## 4-4 查询每门课程的选课人数

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**： 查询每门课程的选课人数，以中文显示课程号、课程名称、选课人数，没有学生选的课程也要显示，按课程号升序排列(**用外连接**)

### 答案

```mysql
 use teaching;
 #--下面输入代码
 SELECT c.cno AS '课程号', c.cn AS '课程名称', COUNT(sc.sno) AS '选课人数' FROM c LEFT JOIN sc ON c.cno = sc.cno GROUP BY c.cno, c.cn ORDER BY c.cno ASC;
 #--代码结束
```

## 4-5 查询没有选课的学生信息

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**： 查询没有选课的学生信息，显示`sno`，`sn`，按学号升序排列

### 答案

```mysql
 use teaching;
 #--下面输入代码
 SELECT sno, sn FROM s WHERE sno NOT IN (SELECT sno FROM sc) ORDER BY sno ASC;
 #--代码结束
```

## 4-6 查询学生所学课程平均分超过80分的学生信息

### 任务描述

已知学生表(`s`)的部分数据如下：

![12](C:\Users\WH\Desktop\数据库\12.png) 

期中`sno`表示学号，`sn`表示姓名，`sex`表示性别，`age`表示年龄，`maj`表示专业，`dept`表示学院

课程表(`c`)的部分数据如下：

 ![13](C:\Users\WH\Desktop\数据库\13.png) 

期中`cno`表示课程号，`cn`表示课程名称，`ct`表示课时，`credit`表示学分

选修表(`sc`)的部分数据如下：

 ![14](C:\Users\WH\Desktop\数据库\14.png) 

期中`sno`表示学号，`cno`表示课程号，`score`表示成绩

**本关任务**： 

查询学生所学课程平均分超过80分的学生信息，以中文显示学号、姓名、平均成绩。按学号升序排列

### 答案

```mysql
 use teaching;
 #--下面输入代码
 SELECT s.sno AS '学号', s.sn AS '姓名', AVG(sc.score) AS '平均成绩' FROM s INNER JOIN sc ON s.sno = sc.sno GROUP BY s.sno, s.sn HAVING AVG(sc.score) > 80 ORDER BY s.sno ASC;
 #--代码结束
```

# 视图

## 5-1 创建单表视图

### 编程要求

根据提示，在右侧编辑器补充代码，根据提供的表完成视图的创建，具体要求如下：

`student`表数据结构：

| stu_id | name | math | chinese |
| ------ | ---- | ---- | ------- |
| 1      | Tom  | 80   | 78      |
| 2      | Jack | 70   | 80      |
| 3      | Lucy | 97   | 95      |

`stu_info`表数据结构：

| stu_id | classes | city |
| ------ | ------- | ---- |
| 1      | 1633    | 长沙 |
| 2      | 1632    | 重庆 |
| 3      | 1633    | 成都 |

在`student`表上创建视图`stu_view`，查询`math`、`chinese`字段并定义一个`math+chinese`成绩之和字段，值为两者之和；

### 答案

```mysql
use School;
#请在此处添加实现代码
########## Begin ##########
#创建单表视图
CREATE VIEW stu_view AS SELECT math, chinese, math+chinese FROM student;
########## End ##########
```

## 5-2 创建多表视图

### 编程要求

根据提示，在右侧编辑器补充代码，根据提供的表完成视图的创建，具体要求如下：

`student`表数据结构：

| stu_id | name | math | chinese |
| ------ | ---- | ---- | ------- |
| 1      | Tom  | 80   | 78      |
| 2      | Jack | 70   | 80      |
| 3      | Lucy | 97   | 95      |

`stu_info`表数据结构：

| stu_id | classes | city |
| ------ | ------- | ---- |
| 1      | 1633    | 长沙 |
| 2      | 1632    | 重庆 |
| 3      | 1633    | 成都 |

在`student`表和`stu_info`表上，创建`stu_classes`视图，查询出`stu_id`、姓名和班级，查询条件为两表中的`stu_id`字段相同

### 答案

```mysql
use School;
#请在此处添加实现代码
########## Begin ##########
#创建多表视图
CREATE VIEW stu_classes AS
SELECT student.stu_id, student.name, stu_info.classes
FROM student
JOIN stu_info ON student.stu_id = stu_info.stu_id;
########## End ##########
```

## 5-3 创建多表视图与使用

### 编程要求

本次编程任务是：

- 在右侧编辑区`create score_view_cdept`下的 `Begin-End`区域补全代码，创建学生的成绩单视图，包括学号`sno` 、姓名`name` 、课程名`cname` 和成绩`grade`字段

  涉及到的数据库和表都已经建立好了，并插入了相应的数据，具体如下： 

  `Student`表结构如下：

  | sno  | name  | sex    | birthday   | discipline | school      |
  | ---- | ----- | ------ | ---------- | ---------- | ----------- |
  | s001 | Tom   | male   | 2019-06-01 | computer   | information |
  | s002 | Bob   | male   | 2019-06-01 | software   | information |
  | s003 | Alice | female | 2019-05-02 | computer   | information |

  `Course`表结构如下：

  | cno            | cname          | description                  | credit         | cinstitution                       |
  | -------------- | -------------- | ---------------------------- | -------------- | ---------------------------------- |
  | :------------: | :------------: | :------------:               | :------------: | :------------:                     |
  | c001           | network        | computer network description | 2              | College Of Information Engineering |
  | c002           | Java           | java description             | 2              | College Of Information Engineering |

  `Score`表结构如下：

  | sno  | cno  | grade |
  | ---- | ---- | ----- |
  | s001 | c001 | 85    |
  | s002 | c001 | 90    |

- 查看创建的视图

### 答案

```mysql
USE studentdb;
#create score_view_cdept
########## Begin ##########
CREATE VIEW score_view_cdept AS
SELECT s.sno, s.name, c.cname, sc.grade
FROM student s
JOIN score sc ON s.sno = sc.sno
JOIN course c ON c.cno = sc.cno;
SELECT * FROM score_view_cdept;
########## end ##########
```

# 分页与索引

## 6-1 分页查询

### 编程要求

根据提示，在右侧编辑器补充代码:

1. 按`prod_id`升序查询表`products`中第`6-10`行数据,只要求`prod_id`字段即可(`prod_id`从1开始)；
2. 利用子查询优化查询出按`prod_id`升序的第`10-15`行数据，只要求`prod_id`字段即可。

数据表结构如下：

![15](C:\Users\WH\Desktop\数据库\15.png)

### 答案

```mysql
USE Products;
#请在此处添加实现代码
########## Begin ##########
#1.分页查询
SELECT prod_id
FROM products
ORDER BY prod_id
LIMIT 5 OFFSET 5;
#2.用子查询优化分页查询语句
SELECT prod_id
FROM (
    SELECT prod_id
    FROM products
    ORDER BY prod_id
    LIMIT 5 OFFSET 10
) AS subquery;
########## End ##########
```

## 6-2 单列索引

### 编程要求

根据提示，在右侧编辑器创建如下`student`表结构，并创建`id`为主键索引，`name`为唯一索引(索引名`name_index`)，`score`为普通索引(索引名`score_index`)。

`student`结构如下:

| 字段名 | 类型、属性             |
| ------ | ---------------------- |
| id     | int(11) ，非空，自增长 |
| name   | varchar(20) ， 非空    |
| score  | int(10)                |

### 答案

```mysql
USE Students;
#请在此处添加实现代码
########## Begin ##########

#1.创建student表结构并且设置id为主键索引
CREATE TABLE student (
  id INT(11) NOT NULL AUTO_INCREMENT,
  name VARCHAR(20) NOT NULL,
  score INT(10),
  PRIMARY KEY (id),
  UNIQUE INDEX name_index (name),
  INDEX score_index (score)
);

#2.对name建立唯一索引


#3.对score建立普通索引

SHOW INDEX FROM student;
########## End ##########
```

## 6-3 组合索引

### 编程要求

根据提示，在右侧编辑器补充 sql 代码。

有如下表`person`，在`name`、`age`、`address`上创建组合索引，索引名`name_city_score` (无需建表，只增加组合索引即可)。

表`person`结构如下所示:

| 字段    | 类型        |
| ------- | ----------- |
| id      | int(11)     |
| name    | varchar(20) |
| age     | int         |
| address | varchar(30) |

### 答案

```mysql
USE Person;
#请在此处添加实现代码
########## Begin ##########
#1.增加组合索引
ALTER TABLE person ADD INDEX name_city_score (name, age, address);
########## End ##########
SHOW INDEX FROM person;
```

## 6-4 索引

### 编程要求

在右侧编辑器补充代码，要求如下：

① 在创建`student`表结构时为`stu_id`字段创建名为`pk_student`的主键索引；

② 在`age`字段上建立名为`idx_age`的普通索引；

③ 在`classes`字段上添加名为`uniq_classes`的唯一索引，并以降序排列；

④ 在`name`、`sex`和`grade`三个字段上建立名为`idx_group`的组合索引。

### 答案

```mysql
use School;
#请在此处添加实现代码
########## Begin ##########
#1.创建名为pk_student的主键索引
create table student(
    stu_id int not null,
    name varchar(25) not null,
    age int not null,
    sex char(2) not null,
    classes int not null,
    grade int not null,
    primary key(stu_id)
);
#2.创建名为idx_age的普通索引
CREATE INDEX idx_age ON student(age);
#3.创建名为uniq_classes的唯一索引
CREATE UNIQUE INDEX uniq_classes ON student(classes DESC);
#4.创建名为idx_group的组合索引
CREATE INDEX idx_group ON student(name, sex, grade);
########## End ##########
```

## 6-5 索引与完整性

### 编程要求

同样的，你需要在我们已经创建好整个`YGGL`数据库的基础上进行以下操作：

建立索引`pk_xs_bak`：对`emp`的`eid`建立索引； 

实现域完整性`ch_tel`：为`emp`的`tel`建立`check`约束，其值只能为`0`-`9`的数字； 

实现实体完整性`un_dept`：为`dept`的`dname`创建唯一性索引； 

实现参照完整性`fk_emp`：将`emp`中的`did`列为外键。

### 答案

```mysql
//请在下面输入创建索引的MySQL语句
/*********begin*********/
CREATE INDEX pk_xs_bak ON emp(eid);
/*********end*********/
//请在下面输入实现域完整性的MySQL语句
/*********begin*********/
ALTER TABLE emp ADD CONSTRAINT ch_tel CHECK (tel REGEXP '^[0-9]+$');
/*********end*********/
//请在下面输入实现实体完整性的MySQL语句
/*********begin*********/
CREATE UNIQUE INDEX un_dept ON dept(dname);
/*********end*********/
//请在下面输入实现参照完整性的MySQL语句
/*********begin*********/
ALTER TABLE emp ADD CONSTRAINT fk_emp FOREIGN KEY (did) REFERENCES dept(did);
/*********end*********/
```

# 增删改查13题

## 更新学生信息

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

学生信息有一个错误，需要更新。学生`ID`为`01`的学生的出生日期(`s_birth`)错误为`'2000-05-15'`，实际应为`'2000-04-30'`。请更新学生表中的相应记录，并在更新后查询学生`ID`为`01`的学生的出生日期。

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
UPDATE student SET s_birth = '2000-04-30' WHERE s_id = '01';
SELECT s_birth FROM student WHERE s_id = '01';
########## End ##########
```

## 查询课程平均分

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

计算课程ID为01的课程的平均成绩

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
select avg(s_score) as '平均成绩' from score where c_id = '01';
########## End ##########
```

## 查询"李"姓老师的数量

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询"李"姓老师的数量

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
select count(*) as cnt_name_li from teacher where t_name like '李%';
########## End ##########
```

## 查询每门课程被选修的学生数

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询每门课程被选修的学生数

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT course.c_id, course.c_name, COUNT(*) AS cnt_student FROM course JOIN score ON course.c_id = score.c_id GROUP BY c_id, c_name;
########## End ##########
```

## 查询学生的总成绩并进行排名

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询学生的总成绩并进行排名

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SET @rank := 0;
SELECT 
    @rank := @rank + 1 AS rank,
    s_id,
    s_name,
    sum_score
FROM 
    (SELECT 
        student.s_id AS s_id,
        student.s_name AS s_name,
        SUM(score.s_score) AS sum_score
     FROM 
        student
     JOIN
        score ON student.s_id = score.s_id
     GROUP BY 
        student.s_id, student.s_name
     ORDER BY 
        sum_score DESC) AS tmp;
########## End ##########
```

## 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT 
    student.s_id,
    s_name,
    COUNT(DISTINCT score.c_id) AS cnt_course,
    COALESCE(SUM(s_score), 0) AS sum_score 
FROM 
    student
LEFT JOIN 
    score ON student.s_id = score.s_id
GROUP BY 
    student.s_id, student.s_name;
########## End ##########
```

## 查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT student.s_id, student.s_name, ROUND(AVG(score.s_score), 2) AS avg_score
FROM student
INNER JOIN score ON student.s_id = score.s_id
GROUP BY student.s_id, student.s_name
HAVING AVG(score.s_score) >= 60;
########## End ##########
```

## 查询学过"张三"老师授课的同学的信息

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询学过"张三"老师授课的同学的信息

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT s.s_id, s.s_name, s_birth, s_sex
FROM student s
JOIN score sc ON s.s_id = sc.s_id
JOIN course c ON sc.c_id = c.c_id
JOIN teacher t ON c.t_id = t.t_id
WHERE t.t_name = '张三';
########## End ##########
```

## 查询选修"张三"老师所授课程的学生中，成绩最高的学生信息及其成绩

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询选修"张三"老师所授课程的学生中，成绩最高的学生信息及其成绩

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT student.s_id, student.s_name, student.s_birth, student.s_sex, MAX(score.s_score) AS max_score FROM student JOIN score ON student.s_id = score.s_id JOIN course ON score.c_id = course.c_id JOIN teacher ON course.t_id = teacher.t_id WHERE teacher.t_name = '张三' GROUP BY student.s_id, student.s_name, student.s_birth, student.s_sex ORDER BY max_score DESC LIMIT 1;
########## End ##########
```

## 查询各学生的年龄(周岁)

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询各学生的年龄(周岁) 按照出生日期来算，当前月日 < 出生年月的月日则，年龄减一

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT s_id, s_name, s_birth, YEAR(CURDATE()) - YEAR(s_birth) - (RIGHT(CURDATE(), 5) < RIGHT(s_birth, 5)) AS s_age
FROM student;
########## End ##########
```

## 查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT s.s_id, s.s_name, ROUND(AVG(sc.s_score),2) AS avg_score
FROM student s
JOIN score sc ON s.s_id = sc.s_id
WHERE sc.s_score < 60
GROUP BY s.s_id, s.s_name
HAVING COUNT(sc.s_id) >= 2;
########## End ##########
```

## 查询各科成绩最高分、最低分和平均分

### 任务描述

已经建立如下四个表，请根据编程要求完成任务： 

`student`表：

![16](C:\Users\WH\Desktop\数据库\16.png) 

`course`表：

 ![17](C:\Users\WH\Desktop\数据库\17.png) 

`score`表：

![18](C:\Users\WH\Desktop\数据库\18.png) 

`teacher`表：

![19](C:\Users\WH\Desktop\数据库\19.png)

表关系如下：

![20](C:\Users\WH\Desktop\数据库\20.png)

### 编程要求

查询各科成绩最高分、最低分和平均分，以如下形式显示：
课程ID，课程name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率
及格为>=60，中等为：70-80，优良为：80-90，优秀为：>=90

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
SELECT 
    c.c_id AS 课程ID,
    c.c_name AS 课程name,
    round(MAX(s.s_score), 2) AS 最高分,
    round(MIN(s.s_score), 2) AS 最低分,
    round(AVG(s.s_score), 2) AS 平均分,
    concat(round(SUM(CASE WHEN s.s_score >= 60 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2),'%') AS 及格率,
    concat(round(SUM(CASE WHEN s.s_score BETWEEN 70 AND 80 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2), '%') AS 中等率,
    concat(round(SUM(CASE WHEN s.s_score BETWEEN 80 AND 90 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2), '%') AS 优良率,
    concat(round(SUM(CASE WHEN s.s_score >= 90 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2), '%') AS 优秀率
FROM 
    score s
    INNER JOIN course c ON s.c_id = c.c_id
GROUP BY 
    c.c_id, c.c_name;
########## End ##########
```

## 体育馆

### 任务描述

本关任务：某市建了一个新的体育馆，每日人流量信息被记录在`gymnasium`表中：序号 (`id`)、日期 (`date`)、 人流量 (`visitors_flow`)

请编写一个查询语句，找出人流量处于高峰的记录 id、日期 date 和人流量 visitors_flow，其中高峰定义为前后连续三天人流量均不少于 100。

`gymnasium`表结构数据如下：

| id   | date       | visitors_flow |
| ---- | ---------- | ------------- |
| 1    | 2019-01-01 | 58            |
| 2    | 2019-01-02 | 110           |
| 3    | 2019-01-03 | 123           |
| 4    | 2019-01-04 | 67            |
| 5    | 2019-01-05 | 168           |
| 6    | 2019-01-06 | 1352          |
| 7    | 2019-01-07 | 382           |
| 8    | 2019-01-08 | 326           |
| 9    | 2019-01-09 | 99            |

提示：每天只有一行记录，日期随着 `id` 的增加而增加。

### 编程要求

请仔细阅读右侧代码，根据方法内的提示，在`Begin - End`区域内进行代码补充

### 答案

```mysql
#请在此添加实现代码
########## Begin ##########
select * from gymnasium where exists (
    select * from (
        select a.date a1,b.date b1,c.date c1 from 
            (select * from gymnasium where visitors_flow >=100) a
            inner join
            (select * from gymnasium where visitors_flow >=100) b
            on b.id-a.id=1
            inner join
            (select * from gymnasium where visitors_flow >=100) c
            on c.id-a.id=2 ) as tb_date
    where gymnasium.date in (a1,b1,c1)
);
########## End ##########
```

